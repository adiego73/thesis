\mode<presentation>

% Background.
\defbeamertemplate*{background}{polimi}{
    % Titlepage.
    \ifnum\c@framenumber=0
        \begin{tikzpicture}[overlay, remember picture]
            \if@bgphoto
                \node at (current page.north) [anchor=north, inner sep=0pt] {\includegraphics[width=\paperwidth]{bgphoto_cut.jpg}};
            \fi
            \node (foot) at (current page.south) [anchor=south, minimum width=\paperwidth, minimum height=0.4415\paperheight, fill=bluePolimi] {};
            \if@nologo\else
                \node at (foot.north) [anchor=south, inner sep=0.5cm] {
                    \if@bgphoto
                        \includegraphics[width=0.3\paperwidth]{logo_centrato_COL_negativo.png}
                    \else
                        \includegraphics[width=0.3\paperwidth]{logo_centrato_COL_positivo.png}
                    \fi
                };
            \fi
            \node at ([shift={(0, -0.1)}] foot.north) {\includegraphics[width=\paperwidth]{decoration.pdf}};
        \end{tikzpicture}
    \else
        \begin{tikzpicture}[overlay, remember picture]
            \node (head) at (current page.north) [anchor=north, minimum width=\paperwidth, minimum height=0.1835\paperheight, fill=bluePolimi] {};
            \node at ([shift={(0, 0.1)}] head.south) {\includegraphics[width=\paperwidth]{decoration.pdf}};
            \node (foot) at (current page.south) [anchor=south, minimum width=\paperwidth, minimum height=0.105\paperheight, fill=bluePolimi] {};
        \end{tikzpicture}
    \fi
}

% Only footer background.
\defbeamertemplate*{background}{footer}{
    \begin{tikzpicture}[overlay, remember picture]
    \node (foot) at (current page.south) [anchor=south, minimum width=\paperwidth, minimum height=0.105\paperheight, fill=bluePolimi] {};
    \end{tikzpicture}
}

% Title page.
\defbeamertemplate*{title page}{polimi}[1][]
{
    \color{white}
    \vspace{4.25cm}
    
    \begin{minipage}[t][\baselineskip]{\paperwidth}
        {\Large\bf \inserttitle}
    \end{minipage}
    \\[\baselineskip]
    \begin{minipage}[t][2\baselineskip]{\paperwidth}
        {\large \insertsubtitle}
    \end{minipage}
    
    \vfill
    
    \begin{minipage}[t][\baselineskip]{\paperwidth}
        {\large\bf \insertauthor}
    \end{minipage}
    
    \begin{minipage}[t][\baselineskip]{\paperwidth}
        \insertdate
    \end{minipage}
    
    \vfill
    
    \addtocounter{framenumber}{-1}
}

% Table of Contents.
\setbeamertemplate{section in toc}[circle]
\setbeamertemplate{subsection in toc}{\leavevmode \leftskip=0.7em {\color{bluePolimi} $\bullet$} \hskip1pt \inserttocsubsection\par}  

% Section page.
\defbeamertemplate*{section page}{polimi}{
    \begin{tikzpicture}[overlay, remember picture]
        \node (foot) at (current page.south) [anchor=south, minimum width=\paperwidth, minimum height=0.4415\paperheight, fill=bluePolimi] {};
        \node at ([shift={(0, -0.1)}] foot.north) {\includegraphics[width=\paperwidth]{decoration.pdf}};
        \path let \p1 = ([shift={(0, 0.105\paperheight+0.25)}] current page.south west), \p2 = (current page.east) in (\x1, \y1) edge [white, line width=0.5] (\x2, \y1);
        \node at ([shift={(\xshift, 3.5)}] current page.south west) [anchor=north west, inner sep=0pt, text width=\textwidth]
        {
            {\color{white}\Large\bf \insertsection}
        };
    \end{tikzpicture}
}
\setbeamertemplate{section page}[polimi]


% Subsection page.
\defbeamertemplate*{subsection page}{polimi}{
    \begin{tikzpicture}[overlay, remember picture]
    \node (foot) at (current page.south) [anchor=south, minimum width=\paperwidth, minimum height=0.4415\paperheight, fill=bluePolimi] {};
    \node at ([shift={(0, -0.1)}] foot.north) {\includegraphics[width=\paperwidth]{decoration.pdf}};
    \path let \p1 = ([shift={(0, 0.105\paperheight+0.25)}] current page.south east), \p2 = (current page.west) in (\paperwidth,\y1) edge [white, line width=0.5] (\x2,\y1);
    \node at ([shift={(\xshift, 3.5)}] current page.south west) [anchor=north west, inner sep=0pt, text width=\textwidth]
    {
        {\color{white}\Large\bf \insertsubsection}
    };
    \end{tikzpicture}
}
\setbeamertemplate{subsection page}[polimi]
